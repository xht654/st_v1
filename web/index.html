<!-- Site Modal - ATUALIZADO COM HEADERS CUSTOMIZADOS E BYPASS -->
<div class="modal fade" id="siteModal" tabindex="-1" aria-labelledby="siteModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="siteModalTitle">
                    <i class="fas fa-plus"></i> Adicionar Site
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="siteForm">
                    
                    <!-- ==================== NOVO: BYPASS DE CAPTURA (NO TOPO) ==================== -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <div class="alert alert-warning border-2" style="border-left: 4px solid #ffc107;">
                                <h6 class="alert-heading mb-3">
                                    <i class="fas fa-bolt text-warning"></i> 
                                    <strong>Modo Bypass (Avan√ßado)</strong>
                                </h6>
                                
                                <div class="form-check form-switch mb-3">
                                    <input class="form-check-input" type="checkbox" id="bypassCapture" onchange="toggleBypassFields()">
                                    <label class="form-check-label fw-bold" for="bypassCapture">
                                        <i class="fas fa-fast-forward text-warning"></i> 
                                        Ativar Bypass de Captura (Pular Detec√ß√£o)
                                    </label>
                                </div>
                                
                                <div id="directStreamUrlField" style="display: none;">
                                    <label for="directStreamUrl" class="form-label fw-bold">
                                        <i class="fas fa-link text-success"></i> 
                                        URL Direto do Stream <span class="text-danger">*</span>
                                    </label>
                                    <input type="url" class="form-control font-monospace" id="directStreamUrl" 
                                           placeholder="https://cdn.exemplo.com/stream/master.m3u8">
                                    <div class="form-text">
                                        <strong>‚ö° Bypass Ativo:</strong> Este URL ser√° usado diretamente no Streamlink, 
                                        <strong>SEM</strong> abrir o site no navegador para detectar streams.
                                        <br>
                                        <strong>Quando usar:</strong> Quando voc√™ j√° conhece o URL exato do stream (M3U8, MPD, etc.)
                                    </div>
                                </div>
                                
                                <small class="text-muted">
                                    <i class="fas fa-info-circle"></i> 
                                    <strong>Bypass:</strong> Pula a detec√ß√£o autom√°tica e usa o URL fornecido diretamente. 
                                    √ötil para streams com URLs conhecidos e est√°veis.
                                </small>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ==================== INFORMA√á√ïES B√ÅSICAS ==================== -->
                    <div class="row mb-4" id="captureMethodGroup">
                        <div class="col-12">
                            <h6 class="border-bottom pb-2 mb-3 text-primary">
                                <i class="fas fa-info-circle"></i> Informa√ß√µes B√°sicas
                            </h6>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="siteName" class="form-label fw-bold">Nome do Site <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="siteName" required 
                                   placeholder="Ex: FreeShot DAZN F1">
                            <div class="form-text">Nome descritivo para identificar o site</div>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="siteUrl" class="form-label fw-bold">URL <span class="text-danger">*</span></label>
                            <input type="url" class="form-control" id="siteUrl" required 
                                   placeholder="https://exemplo.com/stream">
                            <div class="form-text">URL completa do site (apenas para modo detec√ß√£o)</div>
                        </div>
                        
                        <div class="col-md-4 mb-3">
                            <label for="siteCaptureMethod" class="form-label fw-bold">M√©todo de Captura</label>
                            <select class="form-select" id="siteCaptureMethod" onchange="toggleCaptureMethodFields()">
                                <option value="advanced">üî¨ Avan√ßado (Recomendado)</option>
                                <option value="simple">‚ö° Simples</option>
                            </select>
                            <div class="form-text">Avan√ßado: detecta automaticamente. Simples: usa padr√µes definidos</div>
                        </div>
                        
                        <div class="col-md-4 mb-3">
                            <label for="siteWaitTime" class="form-label fw-bold">Tempo de Espera (ms)</label>
                            <input type="number" class="form-control" id="siteWaitTime" value="10000" 
                                   min="1000" max="60000" step="1000">
                            <div class="form-text">Tempo para carregar p√°gina (1000-60000)</div>
                        </div>
                        
                        <div class="col-md-4 mb-3">
                            <label for="sitePriority" class="form-label fw-bold">Prioridade</label>
                            <input type="number" class="form-control" id="sitePriority" value="5" 
                                   min="1" max="10">
                            <div class="form-text">1 = M√°xima, 10 = M√≠nima</div>
                        </div>
                        
                        <div class="col-12 mb-3">
                            <label for="siteUserAgent" class="form-label fw-bold">User Agent</label>
                            <input type="text" class="form-control" id="siteUserAgent" 
                                   placeholder="Mozilla/5.0 (Windows NT 10.0; Win64; x64)...">
                            <div class="form-text">Deixe vazio para usar o padr√£o do sistema</div>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="siteReferer" class="form-label fw-bold">Referer</label>
                            <input type="text" class="form-control" id="siteReferer" 
                                   placeholder="https://exemplo.com/">
                            <div class="form-text">Header Referer usado no Streamlink e navegador</div>
                        </div>
                        
                        <div class="col-md-3 mb-3">
                            <div class="form-check form-switch mt-4 pt-2">
                                <input class="form-check-input" type="checkbox" id="siteEnabled" checked>
                                <label class="form-check-label fw-bold" for="siteEnabled">
                                    <i class="fas fa-toggle-on text-success"></i> Site Habilitado
                                </label>
                            </div>
                        </div>
                        
                        <div class="col-md-3 mb-3">
                            <div class="form-check form-switch mt-4 pt-2">
                                <input class="form-check-input" type="checkbox" id="siteVpnRequired">
                                <label class="form-check-label fw-bold" for="siteVpnRequired">
                                    <i class="fas fa-shield-alt text-warning"></i> Requer VPN
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ==================== NOVO: HEADERS CUSTOMIZADOS ==================== -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <h6 class="border-bottom pb-2 mb-3 text-info">
                                <i class="fas fa-code"></i> Headers HTTP Customizados (JSON)
                            </h6>
                            <div class="alert alert-info mb-3">
                                <i class="fas fa-info-circle"></i> 
                                <strong>Headers Customizados:</strong> Permite definir qualquer header HTTP que ser√° 
                                enviado nas requisi√ß√µes do navegador (Puppeteer) e Streamlink.
                                <br><br>
                                <strong>Formato JSON:</strong> <code>{"Header-Name": "valor", "Another-Header": "valor2"}</code>
                                <br>
                                <strong>Exemplos comuns:</strong>
                                <ul class="mb-0 mt-2">
                                    <li><code>"Referer": "https://exemplo.com/"</code> - Simular origem</li>
                                    <li><code>"Origin": "https://exemplo.com"</code> - CORS</li>
                                    <li><code>"X-Requested-With": "XMLHttpRequest"</code> - AJAX requests</li>
                                    <li><code>"Authorization": "Bearer TOKEN"</code> - Auth tokens</li>
                                    <li><code>"Cookie": "session=abc123"</code> - Cookies</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="col-12 mb-3">
                            <label for="customHeaders" class="form-label fw-bold">
                                <i class="fas fa-brackets-curly"></i> Headers JSON
                            </label>
                            <textarea class="form-control font-monospace" id="customHeaders" rows="8" 
                                      style="font-size: 13px; line-height: 1.6;">{}</textarea>
                            <div class="form-text">
                                <strong>Exemplo v√°lido:</strong><br>
                                <code style="font-size: 12px;">
{<br>
  &nbsp;&nbsp;"Referer": "https://site-origem.com/",<br>
  &nbsp;&nbsp;"Origin": "https://site-origem.com",<br>
  &nbsp;&nbsp;"X-Requested-With": "XMLHttpRequest"<br>
}
                                </code>
                            </div>
                            <div class="form-text text-warning">
                                <i class="fas fa-exclamation-triangle"></i> 
                                <strong>Aten√ß√£o:</strong> Headers sens√≠veis (tokens, cookies) ser√£o ocultados nos logs.
                            </div>
                        </div>
                    </div>
                    
                    <!-- ==================== STREAMLINK SETTINGS ==================== -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <h6 class="border-bottom pb-2 mb-3 text-success">
                                <i class="fas fa-stream"></i> Configura√ß√µes Streamlink
                            </h6>
                        </div>
                        
                        <div class="col-md-3 mb-3">
                            <label for="streamlinkQuality" class="form-label fw-bold">Qualidade</label>
                            <input type="text" class="form-control" id="streamlinkQuality" value="best" 
                                   placeholder="best, 720p, 480p, worst">
                            <div class="form-text">best, 1080p, 720p, 480p, worst</div>
                        </div>
                        
                        <div class="col-md-3 mb-3">
                            <label for="streamlinkRetryStreams" class="form-label fw-bold">Retry Streams</label>
                            <input type="number" class="form-control" id="streamlinkRetryStreams" value="3" 
                                   min="1" max="10">
                            <div class="form-text">Tentativas de reconex√£o ao stream</div>
                        </div>
                        
                        <div class="col-md-3 mb-3">
                            <label for="streamlinkRetryMax" class="form-label fw-bold">Retry Max</label>
                            <input type="number" class="form-control" id="streamlinkRetryMax" value="5" 
                                   min="1" max="20">
                            <div class="form-text">M√°ximo de tentativas totais</div>
                        </div>
                        
                        <div class="col-md-3 mb-3">
                            <div class="form-check form-switch mt-4 pt-2">
                                <input class="form-check-input" type="checkbox" id="streamlinkUseReferer" checked>
                                <label class="form-check-label fw-bold" for="streamlinkUseReferer">
                                    Usar Referer
                                </label>
                            </div>
                        </div>
                        
                        <div class="col-12 mb-3">
                            <label for="streamlinkCustomArgs" class="form-label fw-bold">Argumentos Personalizados</label>
                            <input type="text" class="form-control font-monospace" id="streamlinkCustomArgs" 
                                   placeholder="--ringbuffer-size 16M --hls-timeout 120">
                            <div class="form-text">
                                Argumentos extras do Streamlink (separados por espa√ßo)
                                <br>
                                <strong>Nota:</strong> Headers customizados ser√£o adicionados automaticamente como <code>--http-header</code>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ==================== PADR√ïES DE DETEC√á√ÉO (AVAN√áADO) ==================== -->
                    <div id="advancedCaptureFields" class="row mb-4">
                        <div class="col-12">
                            <h6 class="border-bottom pb-2 mb-3 text-info">
                                <i class="fas fa-search"></i> Padr√µes de Detec√ß√£o (M√©todo Avan√ßado)
                            </h6>
                            <div class="alert alert-info mb-3">
                                <i class="fas fa-info-circle"></i> 
                                <strong>Padr√µes de Detec√ß√£o:</strong> Palavras-chave para identificar URLs de v√≠deo, √°udio e streams combinados.
                            </div>
                        </div>
                        
                        <div class="col-md-4 mb-3">
                            <label for="patternsVideo" class="form-label fw-bold">
                                <i class="fas fa-video text-primary"></i> Padr√µes V√≠deo
                            </label>
                            <input type="text" class="form-control" id="patternsVideo" 
                                   placeholder="tracks-v1, video, v1, hd">
                            <div class="form-text">Separados por v√≠rgula</div>
                        </div>
                        
                        <div class="col-md-4 mb-3">
                            <label for="patternsAudio" class="form-label fw-bold">
                                <i class="fas fa-volume-up text-success"></i> Padr√µes √Åudio
                            </label>
                            <input type="text" class="form-control" id="patternsAudio" 
                                   placeholder="tracks-a1, audio, a1, sound">
                            <div class="form-text">Separados por v√≠rgula</div>
                        </div>
                        
                        <div class="col-md-4 mb-3">
                            <label for="patternsCombined" class="form-label fw-bold">
                                <i class="fas fa-layer-group text-warning"></i> Padr√µes Combinados
                            </label>
                            <input type="text" class="form-control" id="patternsCombined" 
                                   placeholder="index.m3u8, master.m3u8, playlist.m3u8">
                            <div class="form-text">Separados por v√≠rgula</div>
                        </div>
                    </div>
                    
                    <!-- ==================== CAPTURA SIMPLES ==================== -->
                    <div id="simpleCaptureFields" class="row mb-4" style="display: none;">
                        <div class="col-12">
                            <h6 class="border-bottom pb-2 mb-3 text-warning">
                                <i class="fas fa-bolt"></i> Captura Simples - Configura√ß√£o JSON
                            </h6>
                            <div class="alert alert-warning mb-3">
                                <i class="fas fa-exclamation-triangle"></i> 
                                <strong>Modo Simples:</strong> Use quando souber exatamente quais padr√µes procurar.
                            </div>
                        </div>
                        
                        <div class="col-12 mb-3">
                            <label for="simpleCapturePatterns" class="form-label fw-bold">Padr√µes JSON</label>
                            <textarea class="form-control font-monospace" id="simpleCapturePatterns" rows="10" 
                                      style="font-size: 13px; line-height: 1.5;">[]</textarea>
                            <div class="form-text">
                                <strong>Exemplo:</strong><br>
                                <code>[{"type": "combined", "includes": [".m3u8", "token="]}, {"type": "video", "includes": ["tracks-v1"]}]</code>
                            </div>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="simpleCaptureWaitTime" class="form-label fw-bold">Tempo de Espera (ms)</label>
                            <input type="number" class="form-control" id="simpleCaptureWaitTime" value="5000" 
                                   min="1000" max="30000" step="1000">
                            <div class="form-text">Tempo ap√≥s carregar p√°gina (1000-30000)</div>
                        </div>
                    </div>
                    
                    <!-- ==================== AD PROTECTION ==================== -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <h6 class="border-bottom pb-2 mb-3 text-danger">
                                <i class="fas fa-shield-alt"></i> Prote√ß√£o Anti-Ads
                            </h6>
                        </div>
                        
                        <div class="col-md-4 mb-3">
                            <label for="siteAdProtection" class="form-label fw-bold">N√≠vel de Prote√ß√£o</label>
                            <select class="form-select" id="siteAdProtection">
                                <option value="off">üîì Desligado</option>
                                <option value="low">üü° Baixo</option>
                                <option value="medium" selected>üü† M√©dio (Recomendado)</option>
                                <option value="high">üî¥ Alto</option>
                            </select>
                        </div>
                        
                        <div class="col-md-4 mb-3">
                            <label for="adProtectionCustomBlocked" class="form-label fw-bold">
                                <i class="fas fa-ban text-danger"></i> Dom√≠nios Bloqueados
                            </label>
                            <textarea class="form-control font-monospace" id="adProtectionCustomBlocked" rows="5" 
                                      style="font-size: 12px;"
                                      placeholder="ads.exemplo.com&#10;tracker.exemplo.com"></textarea>
                        </div>
                        
                        <div class="col-md-4 mb-3">
                            <label for="adProtectionAllowed" class="form-label fw-bold">
                                <i class="fas fa-check text-success"></i> Dom√≠nios Permitidos
                            </label>
                            <textarea class="form-control font-monospace" id="adProtectionAllowed" rows="5" 
                                      style="font-size: 12px;"
                                      placeholder="cdn.exemplo.com&#10;stream.exemplo.com"></textarea>
                        </div>
                    </div>
                    
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times"></i> Cancelar
                </button>
                <button type="button" class="btn btn-success" onclick="saveSite()">
                    <i class="fas fa-save"></i> Salvar Site
                </button>
            </div>
        </div>
    </div>
</div>
